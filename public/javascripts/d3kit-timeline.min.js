(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("d3-axis"), require("d3-scale"), require("d3-transition"), require("d3-array"), require("d3kit"), require("labella"));
	else if(typeof define === 'function' && define.amd)
		define(["d3-axis", "d3-scale", "d3-transition", "d3-array", "d3kit", "labella"], factory);
	else if(typeof exports === 'object')
		exports["d3KitTimeline"] = factory(require("d3-axis"), require("d3-scale"), require("d3-transition"), require("d3-array"), require("d3kit"), require("labella"));
	else
		root["d3KitTimeline"] = factory(root["d3"], root["d3"], root["d3"], root["d3"], root["d3Kit"], root["labella"]);
})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(1);


/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3_axis__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_d3_axis___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_d3_axis__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3_scale__ = __webpack_require__(3);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_d3_scale___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_d3_scale__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_d3_transition__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_d3_transition___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_d3_transition__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3_array__ = __webpack_require__(5);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_d3_array___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_d3_array__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_d3kit__ = __webpack_require__(6);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_d3kit___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_d3kit__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_labella__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_labella___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_labella__);
var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }








var rectWidth = function rectWidth(d) {
  return d.w;
};
var rectHeight = function rectHeight(d) {
  return d.h;
};
var identity = function identity(d) {
  return d;
};

var Timeline = function (_SvgChart) {
  _inherits(Timeline, _SvgChart);

  _createClass(Timeline, null, [{
    key: 'getDefaultOptions',
    value: function getDefaultOptions() {
      return __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].deepExtend(_get(Timeline.__proto__ || Object.getPrototypeOf(Timeline), 'getDefaultOptions', this).call(this), {
        margin: { left: 40, right: 20, top: 20, bottom: 20 },
        initialWidth: 400,
        initialHeight: 400,
        scale: Object(__WEBPACK_IMPORTED_MODULE_1_d3_scale__["scaleTime"])(),
        domain: undefined,
        direction: 'right',
        dotRadius: 3,
        formatAxis: identity,
        layerGap: 60,
        labella: {},
        keyFn: undefined,
        timeFn: function timeFn(d) {
          return d.time;
        },
        textFn: function textFn(d) {
          return d.text;
        },
        dotColor: '#222',
        labelBgColor: '#222',
        labelTextColor: '#fff',
        linkColor: '#222',
        labelPadding: { left: 4, right: 4, top: 3, bottom: 2 },
        textYOffset: '0.85em'
      });
    }
  }, {
    key: 'getCustomEventNames',
    value: function getCustomEventNames() {
      return ['dotClick', 'dotMouseover', 'dotMousemove', 'dotMouseout', 'dotMouseenter', 'dotMouseleave', 'labelClick', 'labelMouseover', 'labelMousemove', 'labelMouseenter', 'labelMouseleave', 'labelMouseout'];
    }
  }]);

  function Timeline(element, options) {
    _classCallCheck(this, Timeline);

    var _this = _possibleConstructorReturn(this, (Timeline.__proto__ || Object.getPrototypeOf(Timeline)).call(this, element, options));

    _this.layers.create(['dummy', { main: ['axis', 'link', 'label', 'dot'] }]);
    _this.layers.get('main/axis').classed('axis', true);

    _this.force = new __WEBPACK_IMPORTED_MODULE_5_labella___default.a.Force(options.labella);

    _this.updateLabelText = _this.updateLabelText.bind(_this);
    _this.visualize = _this.visualize.bind(_this);
    _this.on('data', _this.visualize);
    _this.on('options', _this.visualize);
    _this.on('resize', _this.visualize);
    return _this;
  }

  _createClass(Timeline, [{
    key: 'resizeToFit',
    value: function resizeToFit() {
      var options = this.options();
      var maxVal = void 0;
      var nodes = this.force.nodes();

      switch (options.direction) {
        case 'up':
          maxVal = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, function (d) {
            return Math.abs(d.y);
          }) || 0;
          this.height(maxVal + options.margin.top + options.margin.bottom);
          break;
        case 'down':
          maxVal = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, function (d) {
            return Math.abs(d.y + d.dy);
          }) || 0;
          this.height(maxVal + options.margin.top + options.margin.bottom);
          break;
        case 'left':
          maxVal = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, function (d) {
            return Math.abs(d.x);
          }) || 0;
          this.width(maxVal + options.margin.left + options.margin.right);
          break;
        case 'right':
          maxVal = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, function (d) {
            return Math.abs(d.x + d.dx);
          }) || 0;
          this.width(maxVal + options.margin.left + options.margin.right);
          break;
      }

      return this;
    }
  }, {
    key: 'updateLabelText',
    value: function updateLabelText(selection, textStyle, accessor) {
      var options = this.options();

      accessor = accessor ? __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].functor(accessor) : identity;

      selection.text(function (d) {
        return options.textFn(accessor(d));
      }).attr('dy', options.textYOffset).attr('x', options.labelPadding.left).attr('y', options.labelPadding.top);

      Object.keys(textStyle).forEach(function (key) {
        var styleFn = textStyle[key];
        selection.style(key, function (d, i) {
          return styleFn(accessor(d), i);
        });
      });

      return selection;
    }
  }, {
    key: 'drawAxes',
    value: function drawAxes() {
      var options = this.options();

      var axisTransform = void 0;

      switch (options.direction) {
        case 'right':
          this.axis = Object(__WEBPACK_IMPORTED_MODULE_0_d3_axis__["axisLeft"])();
          axisTransform = 'translate(' + 0 + ',' + 0 + ')';
          break;
        case 'left':
          this.axis = Object(__WEBPACK_IMPORTED_MODULE_0_d3_axis__["axisRight"])();
          axisTransform = 'translate(' + this.getInnerWidth() + ',' + 0 + ')';
          break;
        case 'up':
          this.axis = Object(__WEBPACK_IMPORTED_MODULE_0_d3_axis__["axisBottom"])();
          axisTransform = 'translate(' + 0 + ',' + this.getInnerHeight() + ')';
          break;
        case 'down':
          this.axis = Object(__WEBPACK_IMPORTED_MODULE_0_d3_axis__["axisTop"])();
          axisTransform = 'translate(' + 0 + ',' + 0 + ')';
          break;
      }

      this.layers.get('main').attr('transform', axisTransform);

      var formatAxis = options.formatAxis || identity;

      formatAxis(this.axis.scale(options.scale));

      this.layers.get('main/axis').call(this.axis);

      return this;
    }
  }, {
    key: 'drawDots',
    value: function drawDots(data) {
      var options = this.options();
      var timePos = function timePos(d) {
        return options.scale(options.timeFn(d));
      };

      var sUpdate = this.layers.get('main/dot').selectAll('circle.dot').data(data, options.keyFn);

      var field = options.direction === 'left' || options.direction === 'right' ? 'cy' : 'cx';

      sUpdate.enter().append('circle').classed('dot', true).on('click', this.dispatchAs('dotClick')).on('mouseover', this.dispatchAs('dotMouseover')).on('mousemove', this.dispatchAs('dotMousemove')).on('mouseout', this.dispatchAs('dotMouseout')).on('mouseenter', this.dispatchAs('dotMouseenter')).on('mouseleave', this.dispatchAs('dotMouseleave')).style('fill', options.dotColor).attr('r', options.dotRadius).attr(field, timePos);

      sUpdate.transition().style('fill', options.dotColor).attr('r', options.dotRadius).attr(field, timePos);

      sUpdate.exit().remove();

      return this;
    }
  }, {
    key: 'drawLabels',
    value: function drawLabels(nodes, labelTextStyle) {
      var options = this.options();
      var nodeHeight = void 0;
      if (options.direction === 'left' || options.direction === 'right') {
        nodeHeight = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, rectWidth);
      } else {
        nodeHeight = Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["max"])(nodes, rectHeight);
      }

      // Before creating the labella renderer, calculate 
      // layerGaps based on innnerHeight, number of layers 
      // and label size 
      if (options.direction === 'up' || options.direction === 'down') {
        var numLayers = 0;
        var maxRectHeight = 0;
        nodes.map(function (node) {
          if (numLayers < node.layerIndex) {
            numLayers = node.layerIndex;
          }
          if (node.h > maxRectHeight) {
            maxRectHeight = node.h;
          }
        });
        numLayers++;
        options.layerGap = (this.getInnerHeight() - numLayers * maxRectHeight) / numLayers;
      }

      var renderer = new __WEBPACK_IMPORTED_MODULE_5_labella___default.a.Renderer({
        nodeHeight: nodeHeight,
        layerGap: options.layerGap,
        direction: options.direction
      });

      renderer.layout(nodes);

      function nodePos(d) {
        switch (options.direction) {
          case 'right':
            return 'translate(' + d.x + ',' + (d.y - d.dy / 2) + ')';
          case 'left':
            return 'translate(' + (d.x + nodeHeight - d.w) + ',' + (d.y - d.dy / 2) + ')';
          case 'up':
            return 'translate(' + (d.x - d.dx / 2) + ',' + d.y + ')';
          case 'down':
            return 'translate(' + (d.x - d.dx / 2) + ',' + d.y + ')';
        }
      }

      var labelBgColor = function labelBgColor(data) {
        return data.labelBgColor ? data.labelBgColor : options.labelBgColor;
      };

      var linkColor = __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].functor(options.linkColor);

      // Draw label rectangles
      var selection = this.layers.get('main/label').selectAll('g.label-g').data(nodes, options.keyFn ? function (d) {
        return options.keyFn(d.data);
      } : undefined);

      var sEnter = selection.enter().append('g').classed('label-g', true).on('click', this.dispatchAs('labelClick')).on('mouseover', this.dispatchAs('labelMouseover')).on('mousemove', this.dispatchAs('labelMousemove')).on('mouseenter', this.dispatchAs('labelMouseenter')).on('mouseleave', this.dispatchAs('labelMouseleave')).on('mouseout', this.dispatchAs('labelMouseout')).attr('transform', nodePos);

      sEnter.append('rect').classed('label-bg', true).attr('rx', 2).attr('ry', 2).attr('width', rectWidth).attr('height', rectHeight).style('fill', function (d) {
        return labelBgColor(d.data);
      });

      sEnter.append('text').classed('label-text', true).call(this.updateLabelText, labelTextStyle, function (d) {
        return d.data;
      });

      var sTrans = selection.transition().attr('transform', nodePos);

      sTrans.select('rect').attr('width', rectWidth).attr('height', rectHeight).style('fill', function (d) {
        return labelBgColor(d.data);
      });

      sTrans.select('text.label-text').call(this.updateLabelText, labelTextStyle, function (d) {
        return d.data;
      });

      selection.exit().remove();

      // Draw path from point on the timeline to the label rectangle
      var paths = this.layers.get('main/link').selectAll('path.link').data(nodes, options.keyFn ? function (d) {
        return options.keyFn(d.data);
      } : undefined);

      paths.enter().append('path').classed('link', true).attr('d', function (d) {
        return renderer.generatePath(d);
      }).style('stroke', function (d) {
        return linkColor(d.data);
      }).style('fill', 'none');

      paths.transition().attr('d', function (d) {
        return renderer.generatePath(d);
      }).style('stroke', function (d) {
        return linkColor(d.data);
      });

      paths.exit().remove();

      return this;
    }
  }, {
    key: 'visualize',
    value: function visualize() {
      var _this2 = this;

      if (!this.hasData() || !this.hasNonZeroArea()) return;

      var data = this.data() || [];
      var options = this.options();
      if (options.direction === 'up' || options.direction === 'down') {
        if (!options.labella.maxPos) {
          options.labella.maxPos = options.initialWidth - options.margin.left - options.margin.right;
          if (!options.labella.density) {
            options.labella.density = 1;
          }
        }
      }
      this.force = new __WEBPACK_IMPORTED_MODULE_5_labella___default.a.Force(options.labella);

      if (options.domain) {
        options.scale.domain(options.domain);
      } else {
        options.scale.domain(Object(__WEBPACK_IMPORTED_MODULE_3_d3_array__["extent"])(data, options.timeFn)).nice();
      }
      options.scale.range([0, options.direction === 'left' || options.direction === 'right' ? this.getInnerHeight() : this.getInnerWidth()]);

      var labelTextStyle = __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].extend({}, options.textStyle);
      Object.keys(labelTextStyle).forEach(function (key) {
        labelTextStyle[key] = __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].functor(labelTextStyle[key]);
      });
      // for backward compatibility
      labelTextStyle.fill = labelTextStyle.fill || __WEBPACK_IMPORTED_MODULE_4_d3kit__["helper"].functor(options.labelTextColor);

      var dummyText = this.layers.get('dummy').append('text').classed('label-text', true);

      var timePos = function timePos(d) {
        return options.scale(options.timeFn(d));
      };
      var nodes = data.map(function (d) {
        var bbox = dummyText.call(_this2.updateLabelText, labelTextStyle, d).node().getBBox();
        var w = bbox.width + options.labelPadding.left + options.labelPadding.right;
        var h = bbox.height + options.labelPadding.top + options.labelPadding.bottom;
        var node = new __WEBPACK_IMPORTED_MODULE_5_labella___default.a.Node(timePos(d), options.direction === 'left' || options.direction === 'right' ? h : w, d);
        node.w = w;
        node.h = h;
        return node;
      });

      dummyText.remove();

      this.force.options(options.labella).nodes(nodes).compute();

      this.drawAxes();
      this.drawDots(data);
      this.drawLabels(this.force.nodes(), labelTextStyle);

      return this;
    }
  }]);

  return Timeline;
}(__WEBPACK_IMPORTED_MODULE_4_d3kit__["SvgChart"]);

/* harmony default export */ __webpack_exports__["default"] = (Timeline);

/***/ }),
/* 2 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_2__;

/***/ }),
/* 3 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_3__;

/***/ }),
/* 4 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_4__;

/***/ }),
/* 5 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_5__;

/***/ }),
/* 6 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_6__;

/***/ }),
/* 7 */
/***/ (function(module, exports) {

module.exports = __WEBPACK_EXTERNAL_MODULE_7__;

/***/ })
/******/ ])["default"];
});